<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„ PWA æ‡‰ç”¨ç¨‹å¼å•Ÿå‹•å™¨</title>
    
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#2196F3">
    
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background-color: #f4f4f4; }
        h1 { color: #333; text-align: center; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .app-list a { display: block; padding: 15px; margin-bottom: 10px; background-color: #e3f2fd; color: #1565C0; text-decoration: none; border-radius: 5px; transition: background-color 0.3s; }
        .app-list a:hover { background-color: #bbdefb; }
        
        /* è‡ªè¨‚å®‰è£æŒ‰éˆ•æ¨£å¼ */
        #installButton {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 20px auto 10px;
            display: none; /* é è¨­éš±è— */
            font-size: 16px;
            text-align: center;
        }
        /* ä¿®æ­£ï¼šç•¶PWAä»¥Appæ¨¡å¼é‹è¡Œæ™‚ï¼Œéš±è—æŒ‰éˆ• */
        @media all and (display-mode: standalone), (display-mode: fullscreen), (display-mode: minimal-ui) {
            #installButton {
                display: none !important; 
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ› ï¸ æˆ‘çš„æ‰€æœ‰ PWA å·¥å…·</h1>
        
        <button id="installButton" style="display: none;">
            é»æˆ‘å®‰è£ App åˆ°æ¡Œé¢
        </button>

        <h2>åŠŸèƒ½æ¸…å–®ï¼š</h2>
        <div class="app-list">
            <a href="./tra-search/index.html">ğŸš† å°éµæ™‚åˆ»è¡¨æŸ¥è©¢</a>
            <a href="./cheatsheet/index.html">ğŸ“Š é¢è©¦æº–å‚™</a>
            </div>
    </div>

    <script>
        let deferredPrompt;
        const installButton = document.getElementById('installButton');

        // 1. ç›£è½å®‰è£äº‹ä»¶ï¼Œå„²å­˜æç¤ºä¸¦é¡¯ç¤ºæŒ‰éˆ•
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installButton.style.display = 'block';
            console.log('Install prompt is ready to be shown.');
        });

        // 2. è™•ç†æŒ‰éˆ•é»æ“Šï¼šæ‰‹å‹•è§¸ç™¼å®‰è£
        installButton.addEventListener('click', () => {
            if (deferredPrompt) {
                // æš«æ™‚éš±è—æŒ‰éˆ•ï¼Œé¿å…é‡è¤‡é»æ“Š
                installButton.style.display = 'none';
                
                // è§¸ç™¼åŸç”Ÿå®‰è£æç¤º
                deferredPrompt.prompt();
                
                // ç›£è½ä½¿ç”¨è€…é¸æ“‡çš„çµæœ
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the install prompt.');
                    } else {
                        console.log('User dismissed the install prompt.');
                        // å¦‚æœä½¿ç”¨è€…é—œé–‰äº†æç¤ºï¼Œæˆ‘å€‘æ¸…é™¤äº‹ä»¶ï¼Œè®“ä¸‹æ¬¡ beforeinstallprompt é‡æ–°è§¸ç™¼
                        deferredPrompt = null;
                    }
                });
            }
        });

        // 3. æ‡‰ç”¨ç¨‹å¼å·²å®‰è£å¾Œï¼Œç¢ºä¿æŒ‰éˆ•æ¶ˆå¤±
        window.addEventListener('appinstalled', (e) => {
            console.log('PWA was successfully installed.');
            installButton.style.display = 'none';
        });

        // 4. è¨»å†Š Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(reg => console.log('Service Worker è¨»å†ŠæˆåŠŸ:', reg.scope))
                    .catch(err => console.error('Service Worker è¨»å†Šå¤±æ•—:', err));
            });
        }
    </script>
</body>
</html>